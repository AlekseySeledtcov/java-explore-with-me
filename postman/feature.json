{
	"info": {
		"_postman_id": "47ad254c-c045-47b8-9632-3fb1d7bbb73b",
		"name": "EWM_Comments",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "45190910",
		"_collection_link": "https://alexey-2439527.postman.co/workspace/Alexey's-Workspace~7c215b3f-7d1a-4553-8506-0fbb84f843cb/collection/45190910-47ad254c-c045-47b8-9632-3fb1d7bbb73b?action=share&source=collection_link&creator=45190910"
	},
	"item": [
		{
			"name": "Pre request",
			"item": [
				{
					"name": "Добавление пользователя админ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"adminId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"knyaz'@mail.com\", \r\n    \"name\": \"Князь киевский\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление пользователя организатора события",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"initiatorId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"Muromec@mail.com\", \r\n    \"name\": \"Илья Муромец\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление пользователя участника 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"popovichId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"Popovich@mail.com\", \r\n    \"name\": \"Алеша Попович\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление пользователя участника 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"dobrinyaId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"email\": \"Nikitich'@mail.com\",\r\n    \"name\": \"Добрыня Никитичь\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление категории",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"categoryId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"Битвы, сражения\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/categories",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"categories"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление события",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"eventId\", pm.response.json().id)"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"annotation\": \"Это будет славная битва\", \r\n    \"category\": {{categoryId}},\r\n    \"description\": \"Битва против захватчиков земель Русских\",\r\n    \"eventDate\": \"2026-01-01 03:00:00\",\r\n    \"location\": {\r\n        \"lat\":3.104,\r\n        \"lon\":-13.4127\r\n        },\r\n    \"participantLimit\": 3,\r\n    \"title\": \"Битва\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{initiatorId}}/events",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{initiatorId}}",
								"events"
							]
						}
					},
					"response": []
				},
				{
					"name": "Обновление данных события",
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"stateAction\": \"PUBLISH_EVENT\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/events/{{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"events",
								"{{eventId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Добавление коментария",
			"item": [
				{
					"name": "Добавление комментария организатором события",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {\r",
									"    pm.response.to.have.status(201);\r",
									"    pm.response.to.have.body; \r",
									"    pm.response.to.have.jsonBody; \r",
									"});\r",
									"pm.test(\"Response body to have correct field\", function() {\r",
									"    pm.response.to.have.jsonBody('id');\r",
									"    pm.response.to.have.jsonBody('text');\r",
									"    pm.response.to.have.jsonBody('state');\r",
									"    pm.response.to.have.jsonBody('authorId');\r",
									"    pm.response.to.have.jsonBody('eventId');\r",
									"    pm.response.to.have.jsonBody('createdOn');\r",
									"    pm.response.to.have.jsonBody('publishedOn');\r",
									"}); \r",
									"pm.test(\"Data status should be PUBLISHED\", function() {\r",
									"    const jsonBody = pm.response.json(); \r",
									"    pm.expect(jsonBody.state).to.eql('PUBLISHED');\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Всех порву, один останусь!\",\r\n    \"eventId\": {{eventId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/user/{{initiatorId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"user",
								"{{initiatorId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление комментария пользователем",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.collectionVariables.set(\"oldComment\", responseJson.text);\r",
									"pm.collectionVariables.set(\"commentId\", responseJson.id);\r",
									"\r",
									"pm.test(\"Status code is 201\", function () {\r",
									"    pm.response.to.have.status(201);\r",
									"});\r",
									"\r",
									"pm.test(\"Response contains required fields\", function () {\r",
									"    const requiredFields = [\"id\", \"text\", \"state\", \"authorId\", \"eventId\", \"createdOn\", \"publishedOn\"];\r",
									"    \r",
									"    requiredFields.forEach(field => {\r",
									"        pm.expect(responseJson, `Field '${field}' is missing`).to.have.property(field);\r",
									"    });\r",
									"});\r",
									"\r",
									"pm.test(\"Data status should be PENDING\", function () {\r",
									"    pm.expect(responseJson.state, \"Field 'state' is not 'PENDING'\").to.eql(\"PENDING\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"И мне немного оставь\",\r\n    \"eventId\": {{eventId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/user/{{popovichId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"user",
								"{{popovichId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Обновление сообщение комментария",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.have.body();\r",
									"});\r",
									"\r",
									"pm.test(\"Field 'text' is not equal old text\", function() {\r",
									"    pm.expect(responseJson.text).not.to.eql(\"oldComment\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"commentId\": {{commentId}},\r\n    \"text\": \"И мне немного оставь, пожалуйста\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/user/{{popovichId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"user",
								"{{popovichId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Публикация комментария",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.have.body();\r",
									"});\r",
									"\r",
									"pm.test(\"Response body contains the correct State\", function () {\r",
									"    pm.expect(responseJson.state).to.eql(\"PUBLISHED\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"commentId\": {{commentId}}, \r\n    \"stateActionAdmin\": \"PUBLISH_EVENT\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/admin/{{popovichId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"admin",
								"{{popovichId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получение комментария по id",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.have.body();\r",
									"});\r",
									"\r",
									"pm.test(\"Comment ID matches\", function () {\r",
									"    pm.expect(responseJson.id).to.eql(pm.collectionVariables.get(\"commentId\"));\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/comments/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получение списка комментариев",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    pm.response.to.have.body(); \r",
									"});\r",
									"\r",
									"pm.test(\"Response is an array\", function () {\r",
									"    pm.expect(responseJson).to.be.an('array');\r",
									"    pm.expect(responseJson).to.not.be.empty; \r",
									"    pm.expect(responseJson).to.have.length(2);\r",
									"    pm.expect(responseJson[0]).to.have.property('id');\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/comments/event/{{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"event",
								"{{eventId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Удаление комментария",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204\", function () {\r",
									"    pm.response.to.have.status(204);\r",
									"});\r",
									"\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"packages": {},
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/user/{{popovichId}}/comment/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"user",
								"{{popovichId}}",
								"comment",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получение списка комментариев, длинна списка должна быть 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"}); \r",
									"\r",
									"pm.test(\"Response is an array with exactly 1 element\", function () {\r",
									"    pm.expect(responseJson).to.be.an('array').with.lengthOf(1);\r",
									"}); "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/comments/event/{{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"event",
								"{{eventId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получение события по ID пользователя (проверка eventShortDto)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    });\r",
									"\r",
									"pm.test(\"Response is an array with exactly 1 element\", function () {\r",
									"    pm.expect(responseJson[0].comments).to.be.an('array').with.lengthOf(1);\r",
									"}); \r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/users/{{initiatorId}}/events",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{initiatorId}}",
								"events"
							],
							"query": [
								{
									"key": "from",
									"value": "0",
									"disabled": true
								},
								{
									"key": "size",
									"value": "10",
									"disabled": true
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавление комментария пользователем",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 201\", function () {\r",
									"    pm.response.to.have.status(201);\r",
									"});\r",
									"\r",
									"pm.test(\"Response contains required fields\", function () {\r",
									"    const requiredFields = [\"id\", \"text\", \"state\", \"authorId\", \"eventId\", \"createdOn\", \"publishedOn\"];\r",
									"    \r",
									"    requiredFields.forEach(field => {\r",
									"        pm.expect(responseJson, `Field '${field}' is missing`).to.have.property(field);\r",
									"    });\r",
									"});\r",
									"\r",
									"pm.test(\"Data status should be PENDING\", function () {\r",
									"    pm.expect(responseJson.state, \"Field 'state' is not 'PENDING'\").to.eql(\"PENDING\");\r",
									"});"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Братцы, меня не забудьте!\",\r\n    \"eventId\": {{eventId}}\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/comments/user/{{dobrinyaId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"comments",
								"user",
								"{{dobrinyaId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получение события по ID (проверка eventFullDto)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let responseJson = pm.response.json();\r",
									"\r",
									"pm.test(\"Status code is 200\", function () {\r",
									"    pm.response.to.have.status(200);\r",
									"    });\r",
									"\r",
									"pm.test(\"Response is an array with exactly 2 element\", function () {\r",
									"    pm.expect(responseJson.comments).to.be.an('array').with.lengthOf(2);\r",
									"}); "
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/events/{{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"events",
								"{{eventId}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "userId",
			"value": 3
		},
		{
			"key": "categoryId",
			"value": ""
		},
		{
			"key": "eventId",
			"value": ""
		},
		{
			"key": "initiatorId",
			"value": ""
		},
		{
			"key": "popovichId",
			"value": ""
		},
		{
			"key": "dobrinyaId",
			"value": ""
		},
		{
			"key": "adminId",
			"value": ""
		},
		{
			"key": "oldComment",
			"value": ""
		},
		{
			"key": "commentId",
			"value": ""
		}
	]
}